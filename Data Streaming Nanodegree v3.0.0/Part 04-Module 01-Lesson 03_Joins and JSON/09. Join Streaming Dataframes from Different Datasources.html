<!-- udacity2.0 -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Join Streaming Dataframes from Different Datasources</title>
  <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="../assets/css/plyr.css">
  <link rel="stylesheet" href="../assets/css/katex.min.css">
  <link rel="stylesheet" href="../assets/css/jquery.mCustomScrollbar.min.css">
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="shortcut icon" type="image/png" href="../assets/img/udacimak.png" />
</head>

<body>
  <div class="wrapper">
    <nav id="sidebar">
  <div class="sidebar-header">
    <h3>Joins and JSON</h3>
  </div>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled components">
    <li class="">
      <a href="01. Lesson Overview.html">01. Lesson Overview</a>
    </li>
    <li class="">
      <a href="02. Why JSON is important.html">02. Why JSON is important?</a>
    </li>
    <li class="">
      <a href="03. Why JSON and joins are important..html">03. Why JSON and joins are important.</a>
    </li>
    <li class="">
      <a href="04. Parse a JSON Payload.html">04. Parse a JSON Payload</a>
    </li>
    <li class="">
      <a href="05. Walkthrough 1 Parse a JSON Payload.html">05. Walkthrough 1: Parse a JSON Payload</a>
    </li>
    <li class="">
      <a href="06. Quiz Parse a JSON payload into separate fields for analysis.html">06. Quiz: Parse a JSON payload into separate fields for analysis</a>
    </li>
    <li class="">
      <a href="07. Exercise Parse a JSON Payload.html">07. Exercise: Parse a JSON Payload</a>
    </li>
    <li class="">
      <a href="08. Solution 1 Parse a JSON Payload.html">08. Solution 1: Parse a JSON Payload</a>
    </li>
    <li class="">
      <a href="09. Join Streaming Dataframes from Different Datasources.html">09. Join Streaming Dataframes from Different Datasources</a>
    </li>
    <li class="">
      <a href="10. Walkthrough 2 Join Streaming Dataframes.html">10. Walkthrough 2: Join Streaming Dataframes</a>
    </li>
    <li class="">
      <a href="11. Quiz Join Streaming Dataframes from Different Datasources.html">11. Quiz: Join Streaming Dataframes from Different Datasources</a>
    </li>
    <li class="">
      <a href="12. Exercise 2 Join Streaming Dataframes.html">12. Exercise 2: Join Streaming Dataframes</a>
    </li>
    <li class="">
      <a href="13. Solution Join Streaming Dataframes.html">13. Solution: Join Streaming Dataframes</a>
    </li>
    <li class="">
      <a href="14. Sink to Kafka.html">14. Sink to Kafka</a>
    </li>
    <li class="">
      <a href="15. Walkthrough 3 Sink to Kafka.html">15. Walkthrough 3: Sink to Kafka</a>
    </li>
    <li class="">
      <a href="16. Quiz Sink to Kafka.html">16. Quiz: Sink to Kafka</a>
    </li>
    <li class="">
      <a href="17. Exercise Sink to Kafka.html">17. Exercise: Sink to Kafka</a>
    </li>
    <li class="">
      <a href="18. Solution 3 Sink to Kafka.html">18. Solution 3: Sink to Kafka</a>
    </li>
    <li class="">
      <a href="19. Edge Cases.html">19. Edge Cases</a>
    </li>
    <li class="">
      <a href="20. Glossary.html">20. Glossary</a>
    </li>
    <li class="">
      <a href="21. Further Reading.html">21. Further Reading</a>
    </li>
    <li class="">
      <a href="22. Lesson Review.html">22. Lesson Review</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>
</nav>

    <div id="content">
      <header class="container-fluild header">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="align-items-middle">
                <button type="button" id="sidebarCollapse" class="btn btn-toggle-sidebar">
                  <div></div>
                  <div></div>
                  <div></div>
                </button>

                <h1 style="display: inline-block">09. Join Streaming Dataframes from Different Datasources</h1>
              </div>
            </div>
          </div>
        </div>
      </header>

      <main class="container">
        <div class="row">
          <div class="col-12">
            <div class="ud-atom">
  <h3><p>Join two streaming dataframes from different datasources Heading</p></h3>
  <div>
  <h2 id="join-streaming-dataframes-from-different-datasources">Join Streaming Dataframes from Different Datasources</h2>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>ND029 DSND C2 L2 A07 Joining DataFrames V2</p></h3>
  <video controls>
  <source src="09. ND029 DSND C2 L2 A07 Joining DataFrames V2-NjxTyb0R9QU.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="09. ND029 DSND C2 L2 A07 Joining DataFrames V2-NjxTyb0R9QU.en.vtt" label="en">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/slide-47-1.jpeg" alt="Joining Data Delivers Value" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Joining Data Delivers Value</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="joining-data-delivers-value">Joining Data Delivers Value</h2>
<ul>
<li>One of the main purposes of writing a streaming application is to accept data from multiple sources</li>
<li>Joining on streaming data can be very powerful because typically the data is changing very rapidly</li>
<li>Creating a combined view of the data as it changes together adds tremendous value</li>
</ul>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/slide-48-1.jpeg" alt="Plan Your Sink" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Plan Your Sink</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="plan-your-sink">Plan Your Sink</h2>
<p>Now that you have looked at your source data, it's time to start planning the <strong>sink</strong>:</p>
<ul>
<li>What is the final goal?</li>
<li>What is the format of the data you plan to send to the other system? </li>
<li>Often the person who knows the answer is someone on another team who needs the data you provide </li>
<li>Other times, there is no definitive answer, so you create your own format</li>
</ul>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/slide-49.jpeg" alt="Data Mocking" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Data Mocking</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="data-mocking">Data Mocking</h2>
<ul>
<li>As you interview system owners from other teams it will be important to discuss the fields they need</li>
<li>Once you have discussed the data that is needed you can create a mock data sample</li>
<li>Ask for feedback on the mock data sample before writing the spark application</li>
<li>This will give you the chance to refine the data model</li>
</ul>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h3 id="what-is-data-mocking">What is Data Mocking?</h3>
<p>**Data Mocking: **to create a representative sample of an undefined source of data (ex: we mocked the data so they could see it).</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="create-the-destination-format">Create the Destination Format</h2>
<pre><code>{
    "customerId": 213923498,
    "originatingAirport": "LAX",
    "destinationAirport": "PDX"
}</code></pre>
<h2 id="remember">Remember</h2>
<p>Sometimes only a few critical fields are what is needed:</p>
<ul>
<li>In this example, there are three fields: <code>"customerId"</code>, <code>"originatingAirport"</code>, and <code>"destinationAirport"</code></li>
<li>It is a common practice to include all available fields, but this can be risky</li>
<li>The downstream consumers may rely on fields that are subject to change</li>
<li>The fewer fields you transmit, the less likely it is that something will change</li>
</ul>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/slide-55-1.jpeg" alt="Identify Redundant Data Fields" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Identify Redundant Data Fields</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="identify-redundant-fields">Identify Redundant Fields</h2>
<p>Now that you have designed the format for your <strong>sink</strong>, you should decide where the data will come from:</p>
<ul>
<li>Certain fields will be present in multiple sources</li>
<li>Some data sources are less authoritative than others</li>
<li>Try to identify which sources are more authoritative for certain types of data</li>
</ul>
<p>In the above diagram, <strong>Customer ID</strong> is present in all three sources. This could be helpful for <strong>joining</strong> customer data as it is generated with departure data.</p>
<p>The** flight number** is present in both the Flight Data and Departure Data sources. This could be helpful for <strong>joining</strong> Flight Data and Departure Data as it is generated. The <strong>Customer Email</strong> field is probably more authoritative in the Customer source than the Flight source.</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/slide-56-1.jpeg" alt="Find Data Source Fields" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Find Data Source Fields</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="find-data-source-fields">Find Data Source Fields</h2>
<p>Once you have identified redundant fields, you should be sure you have all your bases covered:</p>
<ul>
<li>Make sure every field you need in your destination <strong>data sink</strong> has been identified</li>
<li>In the above diagram, the first payload has the <code>"customerId"</code></li>
<li>The second payload contains the <code>"originatingAirport"</code> and <code>"destinationAirport"</code> fields</li>
<li>We will need both payloads to create the final <strong>sink</strong> which includes the <code>"customerId"</code>, <code>"originatingAirport"</code>*, and <code>"destinationAirport"</code> fields</li>
</ul>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/slide-59.jpeg" alt="Identify Join Fields" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Identify Join Fields</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="identify-join-fields">Identify Join Fields</h2>
<p>Before we write our <strong>join</strong>, we need to ensure we have a common field to join on:</p>
<ul>
<li>I may see all the fields I need in various sources</li>
<li>But unless there is a common field, the join won't work</li>
<li>In this example, there are four Data Types: Reservation, VehicleStatus, Checkin, and Payment</li>
<li>They each have unique data</li>
</ul>
<p><strong><em>There are some common fields that connect these together. What are they?</em></strong></p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/slide-60.jpeg" alt="Join Fields Identified" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Join Fields Identified</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="join-fields-identified">Join Fields Identified</h2>
<p>Reservation, VehicleStatus, and Checkin all have a field called <code>"truckNumber"</code>.</p>
<p>Reservation, Checkin, and Payment all contain a field called <code>"reservationId"</code>.</p>
<p>In theory, this example would make joining possible between any two data types with the same field.</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/slide-61.jpeg" alt="New DataFrame with joined fields" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>New DataFrame with joined fields</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="new-dataframe-with-joined-fields">New DataFrame with joined fields</h2>
<p>Joining the <code>Reservation</code> and the <code>VehicleStatus</code> DataFrames we now have the <code>ReservationWithStatus</code> DataFrame with all the data from both DataFrames.</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="what-is-a-join">What is a Join?</h2>
<p>**Join: **to connect two data collections by referencing a field they share in common; or the state which connects two data collections by referencing a common field.</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="verifying-data-standards">Verifying Data Standards</h2>
<p>It is a very good idea to look at samples of each DataSource to see if fields are standardized. Unfortunately, it is common to use the same field name to mean different things, especially in different systems. </p>
<p><strong><em>Look at the four Data Types below. Do you see anything different about them?</em></strong></p>
<h3 id="reservation">Reservation</h3>
<pre><code>{
  "reservationId":"1603561552180",
  "customerName":"Chuck Jones",
  "truckNumber":"2416",
  "reservationDate":"2020-10-24T17:45:52.180Z"
}</code></pre>
<h3 id="vehiclestatus">VehicleStatus</h3>
<pre><code>{
  "truckNumber":"5169",
  "destination":"Florida",
  "milesFromShop":505,
  "odometerReading":50513
}</code></pre>
<h3 id="checkin">CheckIn</h3>
<pre><code>{
   "reservationId":"00001601485848310",
   "locationName":"New Mexico",
   "truckNumber":"3944",
   "status":"In"
}</code></pre>
<h3 id="payment"><code>Payment</code></h3>
<pre><code>{
  "reservationId":"9856743232-L",
  "customerName":"Frank Aristotle",
  "date":"Sep 29, 2020, 10:06:23 AM",
  "amount":"946.88"
}</code></pre>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="data-differences-identified">Data Differences Identified</h2>
<ul>
<li><code>Reservation</code>, <code>Checkin</code>, and <code>Payment</code> all format the <code>"reservationId"</code> differently</li>
<li>After examining <code>Reservation</code> and <code>Checkin</code> it appears the main difference is the leading zeros</li>
<li>Until further data samples are obtained for <code>Payment</code>, it is hard to say if the <code>"reservationId"</code> is the same field, due to the significant difference in format</li>
</ul>
<h3 id="reservation">Reservation</h3>
<p><code>"reservationId":"1603561552180"</code></p>
<h3 id="checkin">CheckIn</h3>
<p><code>"reservationId":"00001601485848310"</code></p>
<h3 id="payment">Payment</h3>
<p><code>"reservationId":"9856743232-L"</code></p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="identify-the-common-field">Identify the Common Field</h2>
<ul>
<li>In this example, we want to join the two payloads shown</li>
<li>What is the common field we can join on?</li>
</ul>
<h3 id="ticketing">Ticketing</h3>
<pre><code>{
   "customerId" : 213923498,
   "ticketId" : 0922345566,
   "flightNumber": 573819429
}</code></pre>
<h3 id="flight-info">Flight Info</h3>
<pre><code> {
  "flightNumber": 573819429,
  "originatingAirport": "LAX",
  "destinationAirport": "PDX"
}</code></pre>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="common-field-identified">Common Field Identified</h2>
<p>The common field in both Ticketing and Flight Info is <code>"flightNumber"</code>:</p>
<h3 id="ticketing">Ticketing</h3>
<p><code>"flightNumber": 573819429</code></p>
<h3 id="flight-info">Flight Info</h3>
<p><code>"flightNumber": 573819429</code></p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="using-a-column-alias-in-spark-sql">Using a Column Alias in Spark SQL</h2>
<p>Using <code>"select columnName as columnNameAlias"</code> can be useful when joining two DataFrames. Usually they will both share at least one column. If you don't use aliases, you may run into errors when trying to join them together.</p>
<p>Example:</p>
<pre><code>flightInfoDF=spark.sql("select flightNumber as flightInfoFlightNumber from FlightInfoView")</code></pre>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="what-does-calling-join-do">What does calling <code>.join</code> do?</h2>
<p>**join: **A function called on a DataFrame that accepts the right hand of the join (another Dataframe), and the join expression (includes the fields to join on). This is the Spark function that implements the concept of joining two different groups of data.</p>
<p>Example: </p>
<pre><code>checkinStatusDF = vehicleStatusSelectStarDF \
.join(vehicleCheckinSelectStarDF, expr("""
    statusTruckNumber = checkinTruckNumber
"""                                                                                 
))</code></pre>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="calling-join-key-points">Calling <code>.join</code> Key Points</h2>
<ul>
<li>You will need two DataFrames defined already</li>
<li>You will want to avoid using the same column names in each DataFrame to avoid collisions</li>
<li>Using field aliases in each DataFrame where needed (ex: <code>"truckNumber as statusTruckNumber"</code>)</li>
<li>The default join type is a left outer join</li>
</ul>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="additional-resources">Additional Resources</h2>
<p>For more reading on joining Spark Streams, check out the <a href="https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html#join-operations" target="_blank">Join Section in the Official Spark Streaming Guide</a></p>
</div>

</div>
<div class="divider"></div>
          </div>

          <div class="col-12">
            <p class="text-right">
              <a href="10. Walkthrough 2 Join Streaming Dataframes.html" class="btn btn-outline-primary mt-4" role="button">Next Concept</a>
            </p>
          </div>
        </div>
      </main>

      <footer class="footer">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <p class="text-center">
                <a href="https://us-udacity.github.io/" target="_blank">【udacity2.0 】If you need more courses, please add wechat：udacity6</a>
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </div>


  <script src="../assets/js/jquery-3.3.1.min.js"></script>
  <script src="../assets/js/plyr.polyfilled.min.js"></script>
  <script src="../assets/js/bootstrap.min.js"></script>
  <script src="../assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="../assets/js/katex.min.js"></script>
  <script>
    // Initialize Plyr video players
    const players = Array.from(document.querySelectorAll('video')).map(p => new Plyr(p));

    // render math equations
    let elMath = document.getElementsByClassName('mathquill');
    for (let i = 0, len = elMath.length; i < len; i += 1) {
      const el = elMath[i];

      katex.render(el.textContent, el, {
        throwOnError: false
      });
    }

    // this hack will make sure Bootstrap tabs work when using Handlebars
    if ($('#question-tabs').length && $('#user-answer-tabs').length) {
      $("#question-tabs a.nav-link").on('click', function () {
        $("#question-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
      $("#user-answer-tabs a.nav-link").on('click', function () {
        $("#user-answer-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
    } else {
      $("a.nav-link").on('click', function () {
        $(".tab-pane").hide();
        $($(this).attr("href")).show();
      });
    }

    // side bar events
    $(document).ready(function () {
      $("#sidebar").mCustomScrollbar({
        theme: "minimal"
      });

      $('#sidebarCollapse').on('click', function () {
        $('#sidebar, #content').toggleClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
      });

      // scroll to first video on page loading
      if ($('video').length) {
        $('html,body').animate({ scrollTop: $('div.plyr').prev().offset().top});
      }

      // auto play first video: this may not work with chrome/safari due to autoplay policy
      if (players && players.length > 0) {
        players[0].play();
      }

      // scroll sidebar to current concept
      const currentInSideBar = $( "ul.sidebar-list.components li a:contains('09. Join Streaming Dataframes from Different Datasources')" )
      currentInSideBar.css( "text-decoration", "underline" );
      $("#sidebar").mCustomScrollbar('scrollTo', currentInSideBar);
    });
  </script>
</body>

</html>
