WEBVTT
Kind: captions
Language: zh-CN

00:00:00.000 --> 00:00:02.609
为了比较 DataFrames 与 Spark SQL 的异同之处

00:00:02.609 --> 00:00:05.939
让我们再走一遍和之前相同数据处理流程

00:00:05.940 --> 00:00:09.130
但这次我们会使用音乐日志的另一个部分

00:00:09.130 --> 00:00:11.325
所以我们的结果会略有不同

00:00:11.324 --> 00:00:14.324
如你所见 我们使用数据形式和之前是一样的

00:00:14.324 --> 00:00:16.454
框架和之前也相同

00:00:16.454 --> 00:00:20.774
但与之前不同的是 我们必须创建一个 DataFrame 的临时视图

00:00:20.774 --> 00:00:24.719
这可以迅速地从 DataFrame 中创建一个临时 SQL 表

00:00:24.719 --> 00:00:27.689
这样你就可以进行

00:00:27.690 --> 00:00:31.020
像在 Postgres 或 MySQL 中的查询了

00:00:31.019 --> 00:00:34.594
我们用 createOrReplaceTempView 这个函数来建表

00:00:34.594 --> 00:00:38.780
你可能猜到了 如果视图尚不存在 这将创建一个新视图

00:00:38.780 --> 00:00:42.484
当视图已经存在 如果底层数据有更新 就会更新视图

00:00:42.484 --> 00:00:45.634
与数据库表不同 这个视图是临时的

00:00:45.634 --> 00:00:47.809
如果关闭笔记本结束本次操作

00:00:47.810 --> 00:00:50.914
在查询之前 你必须重新运行此函数

00:00:50.914 --> 00:00:54.814
视图设置完成后 这里有个 Spark SQL 查询的示例

00:00:54.814 --> 00:00:57.574
但是 还记得惰性评估吗

00:00:57.575 --> 00:01:00.859
你必须使用 collect 或 show 来

00:01:00.859 --> 00:01:03.545
强制 Spark对数据进行处理 并显示结果

00:01:03.545 --> 00:01:07.085
你可以用内联的方式写一些简单的SQL查询

00:01:07.084 --> 00:01:09.829
但我更喜欢用三个撇号 ''' 来写多行的内联查

00:01:09.829 --> 00:01:13.144
这样的 SQL 更易于阅读

00:01:13.144 --> 00:01:17.524
这和Python中进行多行注释的符号相同

00:01:17.525 --> 00:01:20.510
如你所见 你可以用

00:01:20.510 --> 00:01:23.090
Spark SQL 进行与 DataFrames 相同的计算

00:01:23.090 --> 00:01:25.250
虽然 语法上略有不同

00:01:25.250 --> 00:01:29.269
例如 使用 distinct 而不是删除重复项

00:01:29.269 --> 00:01:32.599
另一个小差异是 你必须先注册 UDF

00:01:32.599 --> 00:01:34.069
才能使用它

00:01:34.069 --> 00:01:38.554
不过 UDF 的写法和你在 DataFrames 定义 UDF 的方式非常相似

00:01:38.555 --> 00:01:41.270
就像 DataFrames 一样 你可以非常方便的

00:01:41.269 --> 00:01:44.089
把查询结果转换为 Pandas DataFrames

00:01:44.090 --> 00:01:47.150
并使用 Pandas 附带的库中的所有功能

00:01:47.150 --> 00:01:51.815
Spark SQL 提供了和 DataFrame 几乎相同的功能

00:01:51.814 --> 00:01:54.969
至于你想用哪个 完全取决于你的偏好了

00:01:54.969 --> 00:01:57.629
如果团队或用户更熟悉 SQL 而不是 pandas

00:01:57.629 --> 00:01:59.849
那 Spark SQL 就非常适合了

00:01:59.849 --> 00:02:01.814
无论你喜欢哪种API

00:02:01.814 --> 00:02:03.614
选好一个后

00:02:03.614 --> 00:02:06.634
在余下的课程里都要勤加练习

00:02:06.635 --> 00:02:09.634
比起在不同 API 中来回切换

00:02:09.634 --> 00:02:12.389
不如好好学习一个 API 的各种提示和技巧

